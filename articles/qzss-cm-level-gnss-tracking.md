---
title: "cm級GNSS走行トラッキングにおける測位精度と測位モードの実測レポート"
emoji: "🍜"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [gnss,qzss,clas,soracom,iot]
published: true
---
:::message
「[一般消費者が事業者の表示であることを判別することが困難である表示](https://www.caa.go.jp/policies/policy/representation/fair_labeling/guideline/assets/representation_cms216_230328_03.pdf)」の運用基準に基づく開示: この記事は記載の日付時点で[株式会社ソラコム](https://soracom.jp/)に所属する社員が執筆しました。ただし、個人としての投稿であり、株式会社ソラコムとしての正式な発言や見解ではありません。
:::

## はじめに
:::message
この記事は [SORACOM Advent Calendar 2025](https://qiita.com/advent-calendar/2025/soracom) の20日目の記事です。
19日目の記事は、[@yukataoka(幸人 片岡)](https://qiita.com/yukataoka)さんの[SORACOM Downlink API を活用して kintone からサーバコマンドを実行してみた](https://qiita.com/yukataoka/items/db63c191f29cc0457077)でした。インバウンド通信を閉じてしまった状態で、kintone から SORACOM Downlink API を使ってコマンドを送信し、サーバー側でコマンドを実行しkintoneにその結果を記録するという内容でした。Downlink API便利だと思うので皆さんぜひ使ってほしいです。
:::

さて、つい先日種子島でH3ロケット8号機の打ち上げ作業が行われていたのはご存知でしょうか？
あいにく、カウントダウン中に設備異常を検知し、打ち上げは延期となってしまいましたが原因もわかったようで、週明け月曜日（2025/12/22）には再度打ち上げが予定されています。ぜひ成功してほしいですね。

ちなみに、私は新卒で入社した会社でロケットのシステム設計をする部門に配属され、約6年間ロケットの設計に携わっていました。私が担当した最初の打ち上げでも、カウントダウン中の発射約20秒前に異常が検知され打ち上げが延期となった経験があり、今回のH3ロケットの打ち上げ延期のニュースを聞いて当時のことがすこしフラッシュバックしました。
ロケット開発をしていたのに、なんでいまIoTとか通信とかをやっているのかと思われている方に補足しておくと、当時メインで担当していたのはロケットに搭載されたいくつものセンサーのデータを収集して、地上にある巨大なアンテナ（地上局という）に対してデータを送信するシステム周りの設計だったので、使われる技術は異なりますがデータ収集や通信などIoTにかなり近いことを別の形でやっていました。

えーっと何の話でしたっけ？

はい、H3ロケット8号機ですね。
みなさんはペイロードの衛星が何かご存知でしょうか？そうです、「みちびき5号機」という日本の準天頂衛星システム（QZSS）のGNSS衛星です。
みちびきというのは日本独自の衛星測位システムです。GPS衛星と連携して高精度な測位を実現するためのシステムで、日本上空に常に1機以上の衛星が見えるように配置されているのが特徴です。
というのがこれまでの説明だったのですが、実はみちびきは来年度から7機体制となる、大きな転換点を迎えているということもあり、みちびきに注目してみました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766239306385.png)

https://qzss.go.jp/overview/services/seven-satellite.html より引用

みちびきの中でも特に私が注目しているのは、cmレベルの高精度測位を実現するための補強信号である「CLAS（Centimeter Level Augmentation Service）」です。
詳細はこちら

https://qzss.go.jp/technical/system/l6.html

の通りなのですがざっくりいうと、以下のような特徴があります。
- cmレベルの高精度測位を実現することができる
- 対応する受信機さえあれば、追加の通信費用なしで利用できる

ランニングコスト無しで？？ほんとにcm??いけるの？？と疑問に思ったので、実際にCLAS対応のGNSS受信機を使ってcmレベルの高精度測位がどの程度実現できるのか試してみました。
というのがこのブログ記事の趣旨です。

## やったこと
- CLAS対応GPSモジュール, Raspberry Pi , LTEドングルを組み合わせてGPSトラッカーを作った
- 測位データをSORACOM Harvest Data に送信して、可視化する仕組みを構築した
- 車に乗せて実走行環境で評価した

## システム構成

いたってシンプルにCLAS対応のGPSトラッカー（詳細は後述）を車に搭載し、SORACOM経由でHarvest Dataに測位データを送信して可視化する仕組みを構築しました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766242999354.png)

使った物品とサービスは本当にこれだけです。
- CLAS対応GPSトラッカー（詳細は後述）
- SORACOM IoT SIM (SORACOM Air for Cellular)
  - https://users.soracom.io/ja-jp/guides/getting-started/
- SORACOM Harvest Data
  - https://users.soracom.io/ja-jp/docs/harvest/enable-data/
- SORACOM Lagoon 3
  - https://users.soracom.io/ja-jp/docs/lagoon-v3/
  - https://users.soracom.io/ja-jp/docs/lagoon-v3/getting-started/

## CLAS対応GPSトラッカー(GNSS受信・測位デバイス)の構成

![alt text](/images/qzss-cm-level-gnss-tracking/1766245825228.png)

今回、以下の部品を組み合わせてCLAS対応GPSトラッカーを構築しました。

この部分の具体的な実装についてはまた別のブログに書くのでそちらをご参照ください。

- ZED-F9P RTKシステム開発用ボード:F9PX1
https://www.geosense.co.jp/f9px1_manual/
- みちびき CLAS L6受信用 NEO-D9C開発ボード:D9CX1
https://www.geosense.co.jp/d9cx1_manual/
- CL5/L6対応多周波RTK（ZED-F9P対応）GPS/GNSSアンテナ:BT-345AJ
https://www.beitian.com/en/sys-pd/587.html
- Raspberry Pi 4 Model B
- LTEドングル:Soracom Onyx – LTE™ USB ドングル (SC-QGLC4-C1)
https://users.soracom.io/ja-jp/guides/usb-dongles/soracom-onyx/raspberrypi/
- モバイルバッテリー：TLP115UCCZW
https://tamadenco.co.jp/product/tlp115ucczw/

ポイントとしては、ジオセンス社が出しているCLAS対応のGNSSモジュールを2つ組み合わせて、cmレベルの高精度測位を実現している点です。
アンテナで受信した信号はまず、NEO-D9CモジュールでCLAS信号を受信します。
それと同時に、電波の信号を分岐してZED-F9Pモジュールに渡しています。
ZED-F9PモジュールはGPS衛星からの信号と、NEO-D9CがデコードしたCLAS信号を使ってcmレベルの高精度測位を実現します。
2つの電波信号（GPS衛星信号とCLAS信号）同じアンテナで受信しているのですが周波数が異なるため普通のGPSアンテナではだめで普通のGPSの周波数（L1/L2）とCLASの周波数（L5/L6）の両方に対応したマルチバンドアンテナを使う必要があります。

ZED-F9PモジュールはRaspberry PiとUSBシリアルで接続して、Raspberry Pi上で動作するアプリケーションがNMEAフォーマットで測位データを取得しています。
Raspberry Pi上で動作するアプリケーションはNMEAフォーマットの測位データをJSONにパースして、SORACOM Harvest DataにHTTPリクエストで送信しています。
という、ざっくりそんな作りになっています。
実機のイメージはと言うとこんな感じです。
![alt text](/images/qzss-cm-level-gnss-tracking/1766247245484.png)

2つのGNSSモジュールはピンソケットとピンヘッダで2階建てに接続しています。
![alt text](/images/qzss-cm-level-gnss-tracking/1766247384664.png)

(このあたりの詳細は別でブログ書きますので、細かいことはそっちでお願いします)

## 静止状態での測位精度確認

まずは自宅で測位させてみます。
ここで間違えて緯度経度を貼ってしまうと自宅の位置がセンチメーター単位で特定されてしまうので、なんとなくめっちゃ正確にあっているということが伝わると嬉しいです。

1. 空のよく見える場所で測位させる
今回は自宅のベランダで測位させました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766247611872.png)
ちなみに、しばらく部屋の窓際に置いて試していたのですが、通常のGNSSしか測位せず、CLAS信号を受信できませんでした。
よく考えてみると当たり前で、CLAS信号はみちびき衛星からの信号で、みちびきはほぼ真上に位置しているため、部屋の天井の影になってしまい受信できなかったのです。
それに気づくのに少し時間がかかってしまい、何度も配線やはんだ付けの確認をしてしまいました。

2. 測位データを取得する
この状態で暫く待つと、CLAS信号を受信してcmレベルの高精度測位ができるようになります。
この状態で得られた緯度経度を確認してGoogle Mapsにプロットしてみました。
すると、以下のように先程の写真のようにベランダの手すりの上にほぼ完全に一致してプロットされました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766248140309.png)

こんな感じで、静止状態ではcmレベルの高精度測位が実現できていることがわかりました。


:::message
ちょっとここで用語だけ解説させてください。このあと出てくる測位モードに関する説明です。
専門的には不正確かもしれませんが、ざっくりと以下のように理解しておいてください。

凡例（本記事中の表記）
※ 本記事では「CLAS以外の補強が入っている状態」をまとめてDGPSと呼びます
- **単独測位**：補強なし
- **DGPS**：補強あり（今回は静止衛星からのコード補正（SBAS）を利用）
- **CLAS Float（PPP-RTK Float）**：CLAS補強ありだが、測位解がまだ安定していない状態
- **CLAS Fix（PPP-RTK Fix）**：cm級測位（Fix）。測位解が安定している状態
:::


## 赤坂での動作確認

このまま家の近所でデータを取得してその結果をブログに掲載すると自宅特定のためのヒントをたくさん公開することになってしまうため、赤坂オフィスに向かいます。

赤坂オフィスで、機器の最終チェックをして帰宅がてら測位データを取得しました。
ここからはLagoonのGeo Map panelで測位データを確認していきましょう。
![alt text](/images/qzss-cm-level-gnss-tracking/1766249930566.png)

オフィスから出発して赤坂見附駅に向かう途中のルートです。
赤色の点はオフィスの窓際で取得したデータです。室内のため当然CLAS信号は受信できておらず、通常のGNSS測位しかできていません。
精度も悪くかなりブレています。みなさんがGPSマルチユニットなどで取得しているデータはおそらくこのような感じだと思います。
その後、オフィスを出て屋外に出てCLAS信号を受信することを期待したのですが、赤坂見附駅に到着するまでCLAS信号を受信することはできませんでした。
このあたりは高いビルがところせましと立ち並んでいるため、衛星の電波が届きにくい環境だったのだと思います。
Google Street View で確認しても空が狭いことがよくわかります。

![alt text](/images/qzss-cm-level-gnss-tracking/1766250525031.png)
https://maps.app.goo.gl/GJd2tYxotPjoDxdP9

建物の近くを歩いているときの緯度経度の軌跡は地図上で見ると実際に歩いていたラインと比べて少し建物側にズレているように見えています。
一方で、歩道橋を渡っているときの緯度経度の軌跡は地図の歩道橋の位置とほぼ完全に一致しており、DGPSでもサブメーターオーダーの測位精度は確保できていることがわかります。

赤坂の駅前ではDGPSと単独測位が切り替わりながら精度が落ちていく様子が見て取れています。
![alt text](/images/qzss-cm-level-gnss-tracking/1766250924338.png)

## 車体に搭載したフィールドテストとその結果

赤坂近辺のような、高層ビルが立ち並ぶ環境ではCLAS信号を受信できずcmレベルの高精度測位ができないことがわかりました。
一方で、DGPSでもある程度の測位精度は確保できていることもわかりました。

では、今回の本題であるcmレベルの高精度測位は実際の走行環境でどの程度実現できるのかを確認するために、フィールドテストを実施しました。
アンテナは車のダッシュボードに搭載して、本体側は助手席に座らせます。

### 環八走行

自宅を出て最初走らせながらデータを取得していきます。
はじめしばらくは住宅街を走行していたのですが、15分ほどCLAS信号を受信できずDGPSでの測位となってしまいました。
また、一度CLASを受信したものの、しばらくしてまた受信できなくなってしまいました。

そのまま環状八号線を走行していきます。
なかなかCLASを受信できないまま、環八を走行していきます。
CLASは受信できないもののDGPSでの測位は安定しており、車線はほぼ正確にトレースできています。

![alt text](/images/qzss-cm-level-gnss-tracking/1766251897138.png)

### 首都高走行

いよいよ首都高に入っていきます。
首都高は高架道路であるためほぼ常に空が開けており、CLAS信号を受信しやすいことが期待されます。

期待通り、首都高に入るとすぐにCLAS信号を受信できcmレベルの高精度測位が可能となりました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766252420746.png)

このまま池袋のあたりまでは安定してCLASを受信し続けることができました。
青色の点（CLAS Fix）のプロットからは分岐に備えて、左車線を走行している様子も正確にトレースできています。
![alt text](/images/qzss-cm-level-gnss-tracking/1766252582431.png)

一方で、板橋JCTを過ぎたあたりからはCLAS信号の受信が不安定になり、しばらくするとCLAS信号を受信できなくなってしまい、DGPSでの測位に戻ってしまいました。
ここから先はしばらく、高架の下側を走行します。
![alt text](/images/qzss-cm-level-gnss-tracking/1766252826220.png)
https://maps.app.goo.gl/8rPT6hiLMA25VRTFA

江北JCTまでは高架の下側を通るため、CLAS信号を受信できずDGPSでの測位となってしまいましたが、その後しばらくは空が見えていたにもかかわらず、CLASが受信できずにいました。
このときの速度との関係を確認してみると、しばらく比較的速度を出した状態で巡航していて、その後少し速度が落ちたところでCLAS信号を受信できるようになっていました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766253531263.png)
どうやら今回の条件では、CLASはロストしたあとに再補足をする際、スピードが出ていると補足が難しいようです。
一方で、DGPSでも車線レベルの測位精度は確保できており、青色の点（CLAS Fix）が途切れたあとのオレンジ色の点（DGPS Fix）もほぼ車線上をトレースできています。
その後も一時的なロストを挟みつつも、比較的長い時間CLASを受信し続けることができました。

### 小菅ジャンクションから常磐道走行

小菅ジャンクションから常磐道に入ります。
![alt text](/images/qzss-cm-level-gnss-tracking/1766254711594.png)

加平周辺では上り線が下り線よりも高い位置にあるため、下り線を走行しているときはCLAS信号を受信しにくい状況となっていました。
ただ、上空は開けているだけあって完全にロストすることはなく、断続的にCLAS信号を受信し続けることができました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766254240428.png)
https://maps.app.goo.gl/mfyoH63MwHRqzRWCA

流山ICを過ぎたあたりからは再びCLAS信号をロストしてしまい、DGPSでの測位に戻ってしまいました。
おそらくこのあたりは周りの土地が高く高速道路が地面よりも低い位置にあるため、衛星の電波が届きにくい環境になってしまっているのではないかと推測されます。
![alt text](/images/qzss-cm-level-gnss-tracking/1766254858091.png)
https://maps.app.goo.gl/ocriP6ezdY4B2Lg57

### 柏ICから一般道走行

都内から首都高速を抜けて、郊外柏まで抜けてきました。
ここからは郊外の一般道を走行していきます。

柏IC出口付近の測位状況を見てみましょう。
オレンジ色のDGPS測位からじわじわと緑色のCLAS Floatが見え始めました。ここからは信号待ちや合流等があるため速度がガクッとおちついてきます。
しばらく走らせたところで、青色のCLAS Fixへと切り替わっていく様子がわかります。
![alt text](/images/qzss-cm-level-gnss-tracking/1766279038824.png)

道なりを走行していきます。
この時点でお昼の13時前だったこともあり、しばらく行ったところに[ラーメン山岡家 柏店](https://www.yamaokaya.com/shops/1215/)があるのでそこで昼食をとろうと考えました。

山岡家の前を差し掛かったところ、ちょうどこのあたり。
![alt text](/images/qzss-cm-level-gnss-tracking/1766279354845.png)
https://maps.app.goo.gl/LSVK9qb2whPYHQnL9

駐車場から出ようとしている車と入ろうとしている車があったので、この流れで入れ替わりで入れれば良いなと思い道路側で少し様子を伺っていました。
すると、しばらくして、1台車が出てきたのですが駐車場内の区画に止められずに待っている車が数台あることに気づきました。
このままここに止めていると自分が16号線の渋滞の原因になってしまうので、ここは潔く諦めて[次の山岡家](https://www.yamaokaya.com/shops/1336/) その葛藤のプロットがこちらです。
![alt text](/images/qzss-cm-level-gnss-tracking/1766280760579.png)

#### CLAS Fix だと「止まっている」がデータから分かる
ここで注目してほしいのが、信号待ちで完全に停止している間の測位データです。
青色の点でCLAS Fix しているのでcmレベルの高精度測位ができていることがわかります。
CLASがすごいのがここからで、止まっている間のプロットをさらに拡大してみるとこんな感じで、緯度方向に2分解能、経度方向に1分解能の幅(LagoonというかGrafanaのレンダリングの分解能)の範囲内で止まっている間の測位結果がほぼ完全に同じ位置にプロットされていることがわかります。
![alt text](/images/qzss-cm-level-gnss-tracking/1766280870647.png)

これが何を意味しているかというと、CLASを受信してcmレベルの高精度測位ができている状態では、車が完全に停止している間は測位結果のデータを見るだけで車が止まっていることがわかるということです。
通常の補正無しのGPSでは止まっていても数メートルから数十メートル程度は測位結果がブレてしまうため、止まっていることを測位データから判別することはできません。
これがCLASの強さでありユースケースを考えるうえで重要な点になります。

このあと、注意深く発進して次の信号で右折するために右折車線に入ったのですがその動きも完全に捉えられています。
![alt text](/images/qzss-cm-level-gnss-tracking/1766281162954.png)

...
市街地を車を走らせること約30分

ようやく山岡家に到着しました。柏で山岡家をスルーしてから完全に山岡家の口になってしまっていたので、ようやく食べられるとホッとしました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766281583135.png)

駐車場に停車するときの切り返しも完全に捉えられています。
駐車場停車中の測位データのブレも殆どありません。
![alt text](/images/qzss-cm-level-gnss-tracking/1766281682320.png)

駐車場停車時の緯度経度をGoogle Maps に入れてみると、駐車場の区画の中にほぼ完全に一致してプロットされていることがわかります。
![alt text](/images/qzss-cm-level-gnss-tracking/1766281835289.png)
まさに奥から数えて5区画目のところに止めていて、位置もちょうどダッシュボードのあたりであることがわかります。
が、
撮影した写真を見ると、奥から6区画目に止めているように見えますね。。。あれ、なんでだろう。。。
![alt text](/images/qzss-cm-level-gnss-tracking/1766282631726.png)

ここからはモバイルバッテリーに切り替えて、リュックサックに入れて持ち運びながら行列に並びます。
![alt text](/images/qzss-cm-level-gnss-tracking/1766282709662.png)

測位データを取得し続けていたつもりだったのですが、電源を車の電源からモバイルバッテリーに切り替えた瞬間にGPSモジュールをリセットしてしまったために、CLAS信号をロストしてしまいました。
さらに不幸なことにリュックサックの中でモバイルバッテリーのUSBケーブルが抜けてしまうなどのトラブルもあり、結局山岡家の店内に入るまで並んでいる10分間の間にCLAS信号を受信することはできませんでした。
![alt text](/images/qzss-cm-level-gnss-tracking/1766283438267.png)

ラーメンは美味しくいただきました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766283573227.png)

食事を終えて、店を出たあともまだ並んでいて食事中に測位がうまく行っていないことはわかっていたのですが、流石にこのためだけにもう一度並ぶわけにもいかないので、そのまま帰路につきました。
![alt text](/images/qzss-cm-level-gnss-tracking/1766283678455.png)
これは残課題として、また次回リベンジしたいと思います。

## まとめ

本記事では、u-blox NEO-D9C（CLAS受信）と ZED-F9P（測位）を組み合わせた構成で、測位結果を Raspberry Pi から SORACOM Harvest Data に送信し、Lagoon の Geo Map で可視化する形で実走行環境の評価を行いました。

結論としては、`空の見え方（特に天頂方向の見通し）と、再補足に要する時間`が、CLAS運用の体験を大きく左右する、ということがわかりました。

### 得られた知見
- 静止状態かつ空が開けた環境では、CLAS Fix により非常に安定した測位が得られる
  - 停止中のプロットがほぼ一点に収束し、「止まっている」ことが測位データだけから判別できるのは、従来のGPSと比べて大きな違いでした。
- 都市部（高層ビルが密集する環境）では CLAS の受信が難しく、DGPS/単独測位へフォールバックしやすい
  - 実運用では「CLAS前提」ではなく、フォールバック時に何ができるか（精度・判定・UI）を設計しておく必要があります。
- 走行中にCLASをロストした後の再補足は、状況によって時間がかかる
  - 特に速度が高い状態や、空が十分に開けていない状況では、再び CLAS Fix に戻るまでにラグがありました（体感として）。
- DGPSでも一定レベルの測位精度は確保できる
  - CLASがロストしても、DGPSであればある程度の測位精度は確保できるため、ユースケースによってはDGPS運用も選択肢になり得ます。
  - また、DGPSはZED-F9P単体でも利用できるため、コスト面でのメリットもあります。

※1 DGPS の補強方式（SBAS等）は環境や受信状況に依存します（本記事では詳細は割愛します）

※2 今回の結果はアンテナをダッシュボードに設置した条件での実測であり、ルーフ設置等では受信状況やロスト/再補足の傾向が変わる可能性があります。

### 運用上の注意点
- 電源断（リセット）は強制的に「初期測位からやり直し」になる
  - 今回は車載電源からモバイルバッテリーへ切り替える際にGNSSモジュールがリセットされ、さらにバッグ内で給電が不安定になったことで、行列中に CLAS を再取得できませんでした。
  - 「歩行に持ち出す」「電源を切り替える」ユースケースをやる場合は、以下の対策が必須です。
    - GNSSモジュールがリセットされない給電設計（瞬断対策、UPS的なバッファ、ケーブル抜け対策）
    - CLAS Fix になるまでの待ち時間を見込んだ運用（屋外で空が見える場所に置く等）

### 今後やりたいこと/残課題
- [SORACOM Query](https://soracom.jp/services/query/)で集計して比較する（都市部 / 高速 / 郊外などの詳細なデータ比較）
  （実はこれデータのあたりをつけるためにちょろっとやってはいます）
- ロスト→再補足までの時間を定量化する（速度や空の見え方との関係）
- 持ち運び時の給電設計を改善して、行列中でも CLAS Fix を維持できる構成にしてリベンジする（🍜）
- ラーメン屋さんの行列待ちをcmレベルでトレースする(🍜🍜)
